CREATE SCHEMA AVIATION_SYSTEM;
SET SEARCH_PATH TO AVIATION_SYSTEM;

CREATE TABLE AIRPORT(
	IATAStationCode CHAR(3) PRIMARY KEY,
	"Name" VARCHAR(64) NOT NULL,
	City VARCHAR(64) NOT NULL,
	Country VARCHAR(64) NOT NULL
);

CREATE TABLE TERMINAL(
	IATAStationCode CHAR(3),
	TerminalNumber CHAR(3),
	PRIMARY KEY(IATAStationCode, TerminalNumber)
);

CREATE TABLE RUNWAY(
	RunwayID CHAR(3) PRIMARY KEY,
	Width REAL NOT NULL,
	Length REAL NOT NULL,
	SurfaceType VARCHAR(32) NOT NULL,
	MaintenanceSchedule timestamp,
	IATAStationCode CHAR(3) NOT NULL REFERENCES AIRPORT(IATAStationCode) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE EMPLOYEE(
	EID SMALLINT,
	IATAStationCode CHAR(3) REFERENCES AIRPORT(IATAStationCode) ON UPDATE CASCADE ON DELETE CASCADE,
	FName VARCHAR(32) NOT NULL,
	LName VARCHAR(32) NOT NULL,
	Age SMALLINT NOT NULL,
	Sex CHAR(1) NOT NULL,
	Phone VARCHAR(15) NOT NULL,
	"Address" VARCHAR(128) NOT NULL,
	JobType VARCHAR(64) NOT NULL,
	Salary REAL NOT NULL,
	SuperID SMALLINT,
	PRIMARY KEY(EID,IATAStationCode),
	FOREIGN KEY (SuperID,IATAStationCode) REFERENCES EMPLOYEE(EID,IATAStationCode) ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE AIRLINE(
    IATADesignator CHAR(2) PRIMARY KEY,
    "Name" VARCHAR(30) NOT NULL,
    ThreeDigitCode CHAR(3) NOT NULL
);

CREATE TABLE AIRCRAFT(
    AircraftID VARCHAR(8) PRIMARY KEY,
    Capacity SMALLINT NOT NULL,
    Manufacturer VARCHAR(20) NOT NULL,
    AircraftType VARCHAR(20) NOT NULL,
    MaintenanceSchedule timestamp,
    IATADesignator CHAR(2) NOT NULL REFERENCES AIRLINE(IATADesignator) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE FLIGHT(
    FlightCode VARCHAR(10) PRIMARY KEY,
    FlightType VARCHAR(15) NOT NULL,
    AircraftID VARCHAR(8) NOT NULL REFERENCES AIRCRAFT(AircraftID) ON UPDATE CASCADE ON DELETE CASCADE,
    "Source" VARCHAR(5) NOT NULL,
    Src_Terminal CHAR(2) NOT NULL,
    Destination VARCHAR(5) NOT NULL,
    Dst_Terminal CHAR(2) NOT NULL,
    Departure timestamp NOT NULL,
    Arrival timestamp NOT NULL,
    Duration time NOT NULL,
    "Status" VARCHAR(30) NOT NULL,
    IATADesignator CHAR(2) REFERENCES AIRLINE(IATADesignator) ON UPDATE CASCADE ON DELETE CASCADE
); 

CREATE TABLE JOURNEY(
    JourneyID VARCHAR(10) PRIMARY KEY,
    Source CHAR(3) NOT NULL,
    Destination CHAR(3) NOT NULL,
    NetCost SMALLINT NOT NULL
);

CREATE TABLE TICKETS(
    PNR INT PRIMARY KEY,
    Seat CHAR(3) NOT NULL,
    Class VARCHAR(12) NOT NULL,
    FlightCode VARCHAR(10) NOT NULL REFERENCES FLIGHT(FlightCode) ON UPDATE CASCADE ON DELETE CASCADE,
    JourneyID VARCHAR(10) NOT NULL REFERENCES JOURNEY(JourneyID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE STAFF(
    StaffID SMALLINT,
    IATADesignator CHAR(2) REFERENCES AIRLINE(IATADesignator) ON UPDATE CASCADE ON DELETE CASCADE,
    FName VARCHAR(32) NOT NULL,
    LName VARCHAR(32) NOT NULL,
    Age SMALLINT NOT NULL,
    Sex CHAR(1) NOT NULL,
    Phone VARCHAR(15) NOT NULL, 
    "Address" VARCHAR(128) NOT NULL,
    JobType VARCHAR(64) NOT NULL,
    Salary REAL NOT NULL,
    SuperID SMALLINT,
    FlightCode VARCHAR(10) REFERENCES FLIGHT(FlightCode) 
ON UPDATE CASCADE ON DELETE SET NULL,
    PRIMARY KEY(StaffID,IATADesignator),
    FOREIGN KEY (SuperID,IATADesignator) REFERENCES STAFF(StaffID,IATADesignator) ON UPDATE CASCADE ON DELETE SET NULL
);

CREATE TABLE LAYOVER(
    JourneyID VARCHAR(10) REFERENCES JOURNEY(JourneyID) ON UPDATE CASCADE ON DELETE CASCADE,
    Layover_IATA CHAR(3),
    Duration INT NOT NULL,
    PRIMARY KEY(JourneyID,Layover_IATA)
);

CREATE TABLE LUGGAGE(
    LuggageID CHAR(3) PRIMARY KEY,
    "Type" VARCHAR(20) NOT NULL,
    "Weight" INT NOT NULL,
    JourneyID VARCHAR(10) NOT NULL REFERENCES JOURNEY(JourneyID) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE TRAVELLER(
    ValidID VARCHAR(25) PRIMARY KEY,
    FName VARCHAR(32) NOT NULL,
    LName VARCHAR(32) NOT NULL,
    Age SMALLINT NOT NULL,
    Sex CHAR(1) NOT NULL,
    "Address" VARCHAR(128) NOT NULL
);

CREATE TABLE EMAIL(
    ValidID varchar(25) REFERENCES TRAVELLER(ValidID) ON UPDATE CASCADE ON DELETE CASCADE,
    Email VARCHAR(30),
    PRIMARY KEY(ValidID,EMAIL)
);

CREATE TABLE BOOKS(
    ValidID varchar(25) REFERENCES TRAVELLER(ValidID) ON UPDATE CASCADE ON DELETE CASCADE,
    JourneyID varchar(10) REFERENCES JOURNEY(JourneyID) ON UPDATE CASCADE ON DELETE CASCADE,
    Booking_Date DATE NOT NULL,
    PRIMARY KEY(ValidID,JourneyID)
);

CREATE TABLE CANCELS(
    ValidID varchar(25) REFERENCES TRAVELLER(ValidID) ON UPDATE CASCADE ON DELETE CASCADE,
    JourneyID varchar(10) REFERENCES Journey(JourneyID) ON UPDATE CASCADE ON DELETE CASCADE,
    Cancellation_Date DATE NOT NULL,
    Charge VARCHAR(20) NOT NULL,
    PRIMARY KEY(ValidID, JourneyID)
);

